skill: stacks
version: v1

description: >
  Stack curriculum focused on LIFO discipline, execution state modeling,
  controlled access, and invariant-driven problem solving. Emphasizes stacks
  as flow-control and reasoning structures, not just containers.

slots:

# =========================================================
# SLOT 1 — LIFO & EXECUTION MODEL
# =========================================================

  - slot_id: STACK_SLOT_1_LIFO
    mental_install: "Stacks enforce Last-In-First-Out discipline; the most recent state is always resolved first."
    invariant: "Only the top element is accessible; push adds to top, pop removes from top."
    mastery_signals:
      - Explains LIFO with real execution examples
      - Implements stack with correct top handling
      - Never accesses middle elements
    hard_failures:
      - Treats stack like array
      - Removes from bottom
      - Tracks multiple active positions

    templates:
      - id: stack_s1_impl
        type: coding
        difficulty: easy
        prompt: "Implement a stack with push, pop, and peek."
        language: python
        starter_code: |
          class Stack:
              def __init__(self):
                  self.data = []

              def push(self, x):
                  pass

              def pop(self):
                  pass

              def peek(self):
                  pass
        concepts: [lifo, abstraction, controlled_access]

      - id: stack_s1_explain_lifo
        type: explanation
        difficulty: easy
        prompt: |
          Explain why function calls naturally follow stack order.
          Describe what happens when nested calls return.
        rubric: >
          Must reference last-called-first-returned and execution frames.
        concepts: [call_stack, execution_model]

# =========================================================
# SLOT 2 — REVERSAL & UNWINDING
# =========================================================

  - slot_id: STACK_SLOT_2_REVERSAL
    mental_install: "Stacks reverse order by deferring resolution."
    invariant: "Push preserves order; pop emits reversed order."
    mastery_signals:
      - Uses stack to reverse data
      - Explains unwinding process
      - Models temporary state storage
    hard_failures:
      - Reverses by indexing tricks only
      - Cannot explain why stack reverses
      - Breaks state order

    templates:
      - id: stack_s2_reverse_string
        type: coding
        difficulty: easy
        prompt: "Reverse a string using a stack (no slicing)."
        language: python
        starter_code: |
          def solve(s):
              pass
        concepts: [reversal, deferred_state]

      - id: stack_s2_parentheses
        type: coding
        difficulty: medium
        prompt: "Check if parentheses are balanced."
        language: python
        starter_code: |
          def solve(s):
              pass
        concepts: [state_tracking, matching, invariants]

      - id: stack_s2_unwind_explain
        type: explanation
        difficulty: medium
        prompt: |
          Trace the stack state for the string: '([{}])'.
          Show stack contents after each character.
        rubric: >
          Must show push/pop sequence and empty end state.
        concepts: [stack_trace, invariants]

# =========================================================
# SLOT 3 — MONOTONIC & STRUCTURAL STACKS
# =========================================================

  - slot_id: STACK_SLOT_3_MONOTONIC
    mental_install: "Stacks can enforce global structural invariants across sequences."
    invariant: "Stack maintains ordered property across pushes."
    mastery_signals:
      - Builds monotonic stacks
      - Explains invariant preservation
      - Uses stack to skip work
    hard_failures:
      - Treats as brute-force helper
      - Cannot explain popping logic
      - Breaks monotonic invariant

    templates:
      - id: stack_s3_next_greater
        type: coding
        difficulty: medium
        prompt: "For each element, find the next greater element to the right."
        language: python
        starter_code: |
          def solve(nums):
              pass
        concepts: [monotonic_stack, invariant, optimization]

      - id: stack_s3_histogram
        type: coding
        difficulty: hard
        prompt: "Find the largest rectangle in a histogram."
        language: python
        starter_code: |
          def solve(heights):
              pass
        concepts: [monotonic_stack, boundary_control, optimization]

      - id: stack_s3_invariant_explain
        type: explanation
        difficulty: hard
        prompt: |
          Explain why a monotonic decreasing stack allows you to solve
          Next Greater Element in linear time.
        rubric: >
          Must reference one-pass processing and invariant preservation.
        concepts: [complexity_reasoning, invariant]

# =========================================================
# SLOT 4 — RECURSION & CALL-STACK MODELING (ADVANCED)
# =========================================================

  - slot_id: STACK_SLOT_4_CALL_STACK
    mental_install: "Recursion is implicit stack manipulation."
    invariant: "Each recursive call pushes a frame; return pops it."
    mastery_signals:
      - Simulates recursion with stack
      - Explains stack overflow
      - Converts recursion to iteration
    hard_failures:
      - Treats recursion as magic
      - Cannot trace call frames
      - Breaks termination logic

    templates:
      - id: stack_s4_simulate_recursion
        type: coding
        difficulty: hard
        prompt: "Implement factorial using an explicit stack, not recursion."
        language: python
        starter_code: |
          def solve(n):
              pass
        concepts: [call_stack, simulation, control_flow]

      - id: stack_s4_trace_calls
        type: explanation
        difficulty: hard
        prompt: |
          Draw the call stack evolution for factorial(4).
        rubric: >
          Must show frames pushed and popped with values.
        concepts: [execution_trace, call_stack]
